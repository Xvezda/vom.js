function t(t){this.$context=t}t.select=function(e){return new t("string"==typeof e?document.querySelector(e):e)},t.prototype.on=function(t,e,n){return this.$context.addEventListener(t,e,n),this},t.prototype.off=function(t,e){return this.$context.removeEventListener(t,e),this},t.prototype.context=function(){return this.$context};t.select;const e=Object.create(null);function n(t){this.$target=t,this.$result=void 0,this.$matched=!1}function i(t,n){return Array.isArray(t)?[...t].every(((t,s)=>t===e?n.length>s:i(t,n[s]))):"object"==typeof t&&n?Object.entries(t).map((([t,s])=>s===e?t in n:i(s,n[t]))).every((t=>t)):t===n}n.match=function(t){return new n(t)},n.prototype.when=function(t,n){if(this.$matched)return this;if(t===e)return this.otherwise(n);return("function"==typeof t&&t(this.$target)||t instanceof RegExp&&t.test(this.$target)||Object.keys(t).length>0&&i(t,this.$target)||i(t,this.$target))&&void 0===this.$result&&(this.$matched=!0,this.$result="function"==typeof n?n(this.$target):n),this},n.prototype.otherwise=function(t){return!this.$matched&&t&&(this.$result="function"==typeof t?t():t),this.$result};const s=n.match;class r{constructor(){this.$callbacks=new Map,this.$pending=new Set,this.$id=-1,this._invokeId=-1,this._pendingPayload=void 0,this._invokeCallback=this._invokeCallback.bind(this),this._broadcast=this._broadcast.bind(this),this.waitFor=this.waitFor.bind(this),this.register=this.register.bind(this),this.unregister=this.unregister.bind(this),this.dispatch=this.dispatch.bind(this),this.isDispatching=this.isDispatching.bind(this)}_invokeCallback(t){this._invokeId=t,this.$pending.has(t)?this.waitFor([...this.$pending]):(this.$pending.add(t),this.$callbacks.get(t)(this._pendingPayload),this.$pending.delete(t)),this._invokeId=-1}_broadcast(){[...this.$callbacks.keys()].forEach(this._invokeCallback)}register(t){return++this.$id,this.$callbacks.set(this.$id,t),this.$id}unregister(t){this.$callbacks.delete(t)}waitFor(t){this.$pending.add(this._invokeId);const e=new Set([...t]);for(;[...e].filter((t=>void 0!==t)).map((t=>this.$pending.has(t))).some((t=>t));)[...e].forEach((t=>{e.delete(t),this.$pending.delete(t),this._invokeCallback(t)}))}dispatch(t){this.isDispatching()||(this._pendingPayload=t,this._broadcast(),this._pendingPayload=void 0),this.$pending.clear()}isDispatching(){return-1!==this._invokeId}}class a extends class{constructor(t){this.$id=-1,this.$dispatcher=t,this.$callbacks=new Map,this.$changed=!1,t.register((t=>this.onDispatch(t)))}addListener(t){return this.$id=this.$dispatcher.register(t),{remove:this.$dispatcher.unregister.bind(this.$dispatcher,this.$id)}}getDispatcher(){return this.$dispatcher}getDispatchToken(){return this.$id}hasChanged(){return this.$changed}_emitChange(){this.$changed=!0}onDispatch(t){throw new Error("subclasses must override onDispatch()")}}{constructor(t){super(t),this.$state=this.getInitialState()}getState(){return this.$state}getInitialState(){}reduce(t,e){}areEqual(t,e){return Object.is(t,e)}onDispatch(t){const e=this.reduce(this.getState(),t);this.areEqual(e,this.getState())||(this.$state=e)}}const o=t=>{const e=new r;class n extends a{dispatch(t){return e.dispatch(t)}}n.prototype.reduce=t,n.prototype.subscribe=a.prototype.addListener;const i=new n(e);return e.dispatch({type:"@@store/INIT"}),i};function c(t){const e=Promise.resolve();return"function"==typeof t?e.then(t).catch(console.error):e}function d(t,e){return void 0===t[e]}function h(t,...e){return t instanceof Function?t(...e):t}const u=document.createElement("div");const l=new r;let p=null;function g(t){return s(t).when(Array.isArray,(()=>t.map((t=>g(t))).join(""))).when((()=>["boolean","undefined"].includes(typeof t)||null===t),"").when((()=>t instanceof f||t instanceof $),(()=>t.toString())).when((()=>"function"==typeof t),(()=>{const e=function(t){const e=/[A-Z][A-Za-z0-9_]*/.exec(t.displayName||t.name);return e?e[0]:null}(t);return e&&(p=e),t()})).otherwise((()=>{return e=t.toString(),u.innerHTML="",u.textContent=e,u.innerHTML;var e}))}class f{constructor(t,e){const n=t[0]+t.slice(1).reduce(((t,n,i)=>t+g(e[i])+n),"");this.$result=n.trim()}toString(){return this.$result}}class ${constructor(t){this.$ref=t}toString(){return this.$ref.hash}}function v(t,e,n){if(e||!n)if(!e||n)if(e.nodeType===n.NodeType)switch(e.nodeType){case Node.TEXT_NODE:e.nodeValue!==n.nodeValue&&(n.nodeValue=e.nodeValue);break;case Node.ELEMENT_NODE:e.nodeName!==n.nodeName?t.replaceChild(e,n):(!function(t,e){for(let n=0,i=[...t];n<i.length;++n){const t=i[n],s=e.getNamedItem(i[n].name);null!==s&&s.value===t.value||e.setNamedItem(t.cloneNode(!1))}for(let n=0,i=[...e];n<i.length;++n){const s=i[n];null===t.getNamedItem(s.name)&&e.removeNamedItem(s.name)}}(e.attributes,n.attributes),y(e,n));break;default:throw new Error(`unhandled node type: ${e.nodeType}`)}else t.replaceChild(e,n);else t.appendChild(e);else t.removeChild(n)}function y(t,e){const[n,i]=[[...t.childNodes],[...e.childNodes]];!function(t,e,n){for(let i=0,s=Math.max([...t].length,[...e].length);i<s;++i)n(t[i],e[i],i,t,e)}(n,i,v.bind(null,e))}function m(t,...e){return new f(t,e)}const E=document.createElement("div");function b(t,e){E.innerHTML=e(),y(E,t)}function T(t=0,e){switch(e.type){case"INCREMENT":return t+1;case"RESET":return 0;default:return t}}function S(t=[],e){switch(e.type){case"SET_STATE_IF_EMPTY":if(void 0!==t[e.index])return t.slice();case"SET_STATE":return t.slice(0,e.index).concat(Array.isArray(e.state)?[e.state.slice()]:e.state).concat(t.slice(e.index+1));default:return t}}const N=o(T),x=o(S),w=o(T),_=o(S),k=o(T),I=o(S),A=[];l.register((t=>{var e;"@@voida/RENDER"===t.type&&(A.forEach((t=>t())),(e=A).splice(0,e.length),N.dispatch({type:"RESET"}),w.dispatch({type:"RESET"}),k.dispatch({type:"RESET"}))}));const C=[];function D(t,e){const n=w.getState();w.dispatch({type:"INCREMENT"});const i=d(_.getState(),n)||void 0===e;i&&e&&_.dispatch({type:"SET_STATE",index:n,state:[...e||[]]}),!i&&function(t,e,n=Object.is){return t&&e&&t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}(_.getState()[n],e)||(_.dispatch({type:"SET_STATE",index:n,state:[...e||[]]}),requestAnimationFrame((()=>{c((()=>{const e=t();"function"==typeof e&&A.push(e)}))})))}function M(t){const e=k.getState();let n,i;return k.dispatch({type:"INCREMENT"}),d(I.getState(),e)?(i=Array(2).fill().map((()=>Math.random().toString(36).substring(2))).join(""),n=new $({hash:i,current:t}),I.dispatch({type:"SET_STATE",index:e,state:n})):(n=I.getState()[e],i=n.$ref.hash),c((()=>{n.current=document.querySelector(`[data-ref="${i}"]`)})),n}function R(t,e){const n=M();return function(t,e,n){D((()=>(t.current?.addEventListener(e,n),()=>t.current?.removeEventListener(e,n))))}(n,t,(t=>{const i=`[data-delegate="${n.current.dataset.ref}"`,s=t.target.closest(i);s&&e(s,t)})),n}function q(t){const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let n=0;n<e.length;n++){const[i,s,r]=e[n];if(t[i]&&t[i]===t[s]&&t[i]===t[r])return t[i]}return null}function L(t){return m`
    <button
      class="square"
      data-delegate="${t.delegate}"
      data-idx="${t.idx}"
    >
      ${t.value}
    </button>
  `}function F(t){const e=R("click",(e=>t.onClick(parseInt(e.dataset.idx)))),n=n=>L.bind(null,{delegate:e,idx:n,value:t.squares[n]});return m`
    <div data-ref="${e}">
      <div class="board-row">
        ${n(0)}
        ${n(1)}
        ${n(2)}
      </div>
      <div class="board-row">
        ${n(3)}
        ${n(4)}
        ${n(5)}
      </div>
      <div class="board-row">
        ${n(6)}
        ${n(7)}
        ${n(8)}
      </div>
    </div>
  `}var O,j;O=function(t){const[e,n]=function(t){const e=N.getState();let n;return N.dispatch({type:"INCREMENT"}),C[e]!==p?(C[e]=p,n="SET_STATE"):n="SET_STATE_IF_EMPTY",x.dispatch({type:n,index:e,state:h(t)}),[x.getState()[e],function(t){x.dispatch({type:"SET_STATE",index:e,state:h(t,x.getState()[e])}),l.dispatch({type:"@@voida/RENDER"})}]}({history:[{squares:Array(9).fill(null)}],stepNumber:0,xIsNext:!0}),i=e.history,s=i[e.stepNumber],r=q(s.squares);let a;a=r?"Winner: "+r:"Next player: "+(e.xIsNext?"X":"O");const o=R("click",(t=>{return e=parseInt(t.dataset.move),void n((t=>({...t,stepNumber:e,xIsNext:e%2==0})));var e})),c=i.map(((t,e)=>m`
      <li>
        <button
          data-move="${e}"
          data-delegate="${o}"
        >${e?"Go to move #"+e:"Go to game start"}</button>
      </li>
    `));return m`
    <div class="game">
      <div class="game-board">
        ${F.bind(null,{squares:s.squares,onClick:t=>(t=>{n((e=>{const n=e.history.slice(0,e.stepNumber+1),i=n[n.length-1].squares.slice();return q(i)||i[t]?{...e}:(i[t]=e.xIsNext?"X":"O",{history:n.concat([{squares:i}]),stepNumber:n.length,xIsNext:!e.xIsNext})}))})(t)})}
      </div>
      <div class="game-info">
        <div>${a}</div>
        <ol data-ref="${o}">${c}</ol>
      </div>
    </div>
  `},j=document.getElementById("root"),window.addEventListener("DOMContentLoaded",(()=>{b(j,(()=>m`${O}`)),l.register((t=>{let e=0,n=!1;const i=(...i)=>{if(!n){const s=()=>{t(...i),n=!1,e=0};e=requestAnimationFrame(s),n=!0}};return i.cancel=()=>cancelAnimationFrame(e),i})((t=>{"@@voida/RENDER"===t.type&&b(j,(()=>m`${O}`))})))}));
//# sourceMappingURL=index.0d7bf6e7.js.map
